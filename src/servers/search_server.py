from mcp.server.fastmcp import FastMCP

mcp = FastMCP("search-server", json_response=True)


@mcp.tool()
def search_docs(query: str, top_k: int = 3) -> list[dict]:
    """
    Демонстрационный поисковой тул — теперь с более объёмными и реалистичными документами.
    """
    demo_corpus = [
        {
            "id": "1",
            "title": "MCP",
            "text": (
                "Model Context Protocol (MCP) — это универсальный стандарт взаимодействия между LLM и внешними "
                "инструментами. MCP создаёт предсказуемый, согласованный интерфейс, позволяющий языковым моделям "
                "обращаться к файлам, БД, векторным хранилищам, API, ML-модулям и пользовательскому коду так же "
                "просто, как к обычным функциям. "
                "Сервер MCP инкапсулирует бизнес-логику: поиск, аналитика, агрегации, вызов моделей ранжирования "
                "и классификации, доступ к документам или метаданным. "
                "С точки зрения модели MCP превращает сложные системы в набор самостоятельных инструментов, "
                "которые можно комбинировать в длинных цепочках (tool-chains). "
                "Благодаря стандартизации MCP упрощает построение AI-агентов, которые автоматически выбирают "
                "и вызывают нужные инструменты на основе пользовательского запроса."
            ),
        },
        {
            "id": "2",
            "title": "Python",
            "text": (
                "Python остаётся ключевым языком для построения ML/AI-систем благодаря простоте синтаксиса, "
                "мощной экосистеме библиотек и широкой поддержке научного сообщества. "
                "На Python разворачивают MCP-серверы, оборачивают вычислительные ядра и сторонние сервисы в "
                "удобные функции, связывают микросервисы, модели и базы данных. "
                "Язык предоставляет огромное количество инструментов для работы с данными — от NumPy и Pandas "
                "до PyTorch и TensorFlow, а также библиотеки для оркестрации, очередей, gRPC, WebSocket, "
                "REST и асинхронных взаимодействий. "
                "Python хорошо подходит для быстрых прототипов, но также может масштабироваться в продакшен "
                "при помощи горизонтального шардирования, контейнеризации и распределённых вычислений."
            ),
        },
        {
            "id": "3",
            "title": "Machine learning",
            "text": (
                "Машинное обучение в контексте современных AI-агентов — это не только большие языковые модели "
                "и генеративные системы. "
                "ML-компоненты включают классические алгоритмы, такие как логистическая регрессия, градиентный "
                "бустинг, деревья решений, случайный лес, а также модели ранжирования, фильтрации, рекомендаций "
                "и анализа временных рядов. "
                "AI-агенты могут вызывать эти модели как сервисы или инструменты: например, классификатор для "
                "определения тональности текста, модель для прогнозирования спроса, ранкер для выдачи поисковых "
                "результатов или модель NER для извлечения сущностей. "
                "Машинное обучение обеспечивает агентам способность принимать решения, адаптироваться к контексту "
                "и выполнять задачи, выходящие за рамки генеративной логики."
            ),
        },
        {
            "id": "4",
            "title": "AI agent",
            "text": (
                "Современный AI-агент — это система, которая сочетает LLM с инструментами, сервисами и внешними "
                "данными, создавая целостное умное поведение. "
                "Агент анализирует пользовательский запрос, выбирает необходимые MCP-инструменты (поиск, "
                "суммаризация, векторные запросы, напоминания, ML-модули, API-вызовы), выполняет их по цепочке "
                "и комбинирует результаты в финальный ответ. "
                "Такой подход снимает ограничения LLM, расширяя её возможностями внешних систем. "
                "AI-агент может действовать как ассистент, аналитик, интегратор, исполнитель процессов "
                "и даже как автономный рабочий модуль. "
                "Главная сила агента — способность не просто отвечать на вопросы, а выполнять задачи, требующие "
                "многих шагов, принятия решений, анализа данных и адаптации под контекст."
            ),
        },
        {
            "id": "5",
            "title": "Neural Networks",
            "text": (
                "Нейронные сети — основа современных моделей глубокого обучения. Они состоят из слоёв, "
                "которые преобразуют входные данные через последовательность нелинейных операций, обучаясь "
                "распознавать сложные паттерны. "
                "Классические архитектуры включают полносвязные сети, сверточные сети (CNN), рекуррентные (RNN), "
                "а также трансформеры — наиболее успешный современный подход. "
                "Трансформеры лежат в основе GPT, BERT, T5 и многих других моделей, обеспечивая обработку текста, "
                "кода, изображений, аудио и мультимодальности. "
                "Нейросети используются для классификации, генерации, сегментации, распознавания речи, "
                "управления роботами и анализа временных рядов."
            ),
        },
    ]

    q = query.lower()
    filtered = [
        d for d in demo_corpus
        if q in d["title"].lower() or q in d["text"].lower()
    ]
    return filtered[:top_k]


if __name__ == "__main__":
    mcp.run()
