from mcp.server.fastmcp import FastMCP

mcp = FastMCP("search-server", json_response=True)


@mcp.tool()
def search_docs(query: str, top_k: int = 3) -> list[dict]:
    """
    Демонстрационный поисковой тул.
    """
    demo_corpus = [
        {
            "id": "1",
            "title": "MCP",
            "text": (
                "Model Context Protocol (MCP) — это способ подключать внешние инструменты "
                "и источники данных к LLM через единый, предсказуемый интерфейс. "
                "Серверы MCP инкапсулируют логику (поиск, БД, ML-сервисы), "
                "а клиент — оркестрирует их вызовы в одном диалоге."
            ),
        },
        {
            "id": "2",
            "title": "Python",
            "text": (
                "Python остаётся основным языком для ML и AI-инструментов: "
                "на нём поднимают MCP-серверы, оборачивают модели, пишут обвязку вокруг "
                "LLM/векторных хранилищ и оркестраторов. Он удобен для быстрой прототипизации "
                "и при этом хорошо масштабируется в прод."
            ),
        },
        {
            "id": "3",
            "title": "Machine learning",
            "text": (
                "ML в контексте AI-агентов — это не только большие языковые модели. "
                "Это ещё и модели ранжирования, рекомендации, классификации и извлечения "
                "структурированной информации, которые агент может вызывать как обычные инструменты."
            ),
        },
        {
            "id": "4",
            "title": "AI agent",
            "text": (
                "Современный AI-агент — это не просто чат-бот, а оркестратор над набором инструментов. "
                "LLM анализирует запрос пользователя, выбирает нужные MCP-тулинги "
                "(поиск, суммаризация, напоминания, ML-сервисы), вызывает их по цепочке "
                "и возвращает цельный ответ, скрывая всю сложность инфраструктуры."
            ),
        },
    ]

    q = query.lower()
    filtered = [
        d for d in demo_corpus
        if q in d["title"].lower() or q in d["text"].lower()
    ]
    return filtered[:top_k]


if __name__ == "__main__":
    # Важно: просто mcp.run(), без своих asyncio/anyio
    mcp.run()
