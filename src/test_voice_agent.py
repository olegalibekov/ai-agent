#!/usr/bin/env python3
"""
Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð°Ð³ÐµÐ½Ñ‚Ð°
Ð¡Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
"""

import os
from voice_agent import VoiceAgent
from dotenv import load_dotenv

load_dotenv()

def test_agent_with_text_input():
    """Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð°Ð³ÐµÐ½Ñ‚ Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¼Ð¸ Ð²Ð²Ð¾Ð´Ð°Ð¼Ð¸ (ÑÐ¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ Ð³Ð¾Ð»Ð¾ÑÐ°)"""
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ API ÐºÐ»ÑŽÑ‡
    if not os.environ.get("ANTHROPIC_API_KEY"):
        print("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ ANTHROPIC_API_KEY")
        return
    
    print("\n" + "="*60)
    print("ðŸ§ª Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• Ð“ÐžÐ›ÐžÐ¡ÐžÐ’ÐžÐ“Ðž ÐÐ“Ð•ÐÐ¢Ð")
    print("="*60)
    print("Ð¡Ð¸Ð¼ÑƒÐ»ÑÑ†Ð¸Ñ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ‡ÐµÑ€ÐµÐ· Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð²Ð²Ð¾Ð´\n")
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð°Ð³ÐµÐ½Ñ‚Ð°
    agent = VoiceAgent()
    
    # Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
    test_queries = [
        "ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÑÑƒÐ¼Ð¼Ñƒ Ñ‡Ð¸ÑÐµÐ» Ð¾Ñ‚ 1 Ð´Ð¾ 100",
        "Ð”Ð°Ð¹ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¸ÑÐºÑƒÑÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚Ð°",
        "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð°Ð½ÐµÐºÐ´Ð¾Ñ‚ Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸ÑÑ‚Ð¾Ð²",
        "Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ ÐºÐ²Ð°Ð½Ñ‚Ð¾Ð²Ð°Ñ Ñ„Ð¸Ð·Ð¸ÐºÐ° Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸?",
        "ÐŸÐ¾ÑÐ¾Ð²ÐµÑ‚ÑƒÐ¹ Ñ‚Ñ€Ð¸ ÐºÐ½Ð¸Ð³Ð¸ Ð¿Ð¾ Ð¼Ð°ÑˆÐ¸Ð½Ð½Ð¾Ð¼Ñƒ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸ÑŽ"
    ]
    
    print("ðŸ“‹ Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹:")
    for i, query in enumerate(test_queries, 1):
        print(f"  {i}. {query}")
    print()
    
    # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
    for i, query in enumerate(test_queries, 1):
        print("\n" + "="*60)
        print(f"Ð¢Ð•Ð¡Ð¢ {i}/{len(test_queries)}")
        print("="*60)
        print(f"ðŸ“ Ð—Ð°Ð¿Ñ€Ð¾Ñ: {query}")
        print()
        
        # ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· LLM
        response = agent.process_with_llm(query)
        
        # Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚
        print("="*60)
        print("ðŸ“ ÐžÐ¢Ð’Ð•Ð¢:")
        print(response)
        print("="*60 + "\n")
        
        input("ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Enter Ð´Ð»Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ñ‚ÐµÑÑ‚Ð°...")
    
    print("\nâœ… Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹!")


def show_usage_instructions():
    """ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ"""
    print("\n" + "="*60)
    print("ðŸ“– Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ ÐŸÐž Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐÐ˜Ð®")
    print("="*60)
    print("""
1. Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð—ÐÐ’Ð˜Ð¡Ð˜ÐœÐžÐ¡Ð¢Ð•Ð™:
   pip install SpeechRecognition anthropic pyaudio

2. ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ API ÐšÐ›Ð®Ð§Ð:
   export ANTHROPIC_API_KEY='your-api-key-here'

3. Ð—ÐÐŸÐ£Ð¡Ðš Ð“ÐžÐ›ÐžÐ¡ÐžÐ’ÐžÐ“Ðž ÐÐ“Ð•ÐÐ¢Ð:
   python voice_agent.py
   
   - Ð“Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ "Ð¡Ð»ÑƒÑˆÐ°ÑŽ..."
   - Ð”Ð»Ñ Ð²Ñ‹Ñ…Ð¾Ð´Ð° ÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ: "Ð²Ñ‹Ñ…Ð¾Ð´", "ÑÑ‚Ð¾Ð¿" Ð¸Ð»Ð¸ "Ð¿Ð¾ÐºÐ°"
   - Ð˜Ð»Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C

4. Ð—ÐÐŸÐ£Ð¡Ðš Ð¢Ð•Ð¡Ð¢ÐžÐ’ (Ð±ÐµÐ· Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð°):
   python test_voice_agent.py

5. ÐŸÐ Ð˜ÐœÐ•Ð Ð« Ð“ÐžÐ›ÐžÐ¡ÐžÐ’Ð«Ð¥ ÐšÐžÐœÐÐÐ”:
   - "ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð°Ð» 5"
   - "Ð”Ð°Ð¹ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð±Ð»Ð¾ÐºÑ‡ÐµÐ¹Ð½Ð°"
   - "Ð¡ÐºÐ°Ð¶Ð¸ Ð°Ð½ÐµÐºÐ´Ð¾Ñ‚"
   - "Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ð¼Ð°ÑˆÐ¸Ð½Ð½Ð¾Ðµ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ"
   - "ÐŸÐ¾ÑÐ¾Ð²ÐµÑ‚ÑƒÐ¹ ÐºÐ½Ð¸Ð³Ñƒ"

6. ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐœÐ˜ÐšÐ ÐžÐ¤ÐžÐÐ (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾):
   - ÐÐ³ÐµÐ½Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÐºÐ°Ð»Ð¸Ð±Ñ€ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ
   - Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
   - Ð“Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚Ðµ Ñ‡ÐµÑ‚ÐºÐ¾, Ð½Ðµ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñ‚Ð¸Ñ…Ð¾

7. ÐŸÐžÐ”Ð”Ð•Ð Ð–Ð˜Ð’ÐÐ•ÐœÐ«Ð• Ð¯Ð—Ð«ÐšÐ˜:
   - Ð ÑƒÑÑÐºÐ¸Ð¹ (ru-RU) - Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
   - ÐœÐ¾Ð¶Ð½Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð² ÐºÐ¾Ð´Ðµ: recognize_google(audio, language='...')
""")
    print("="*60 + "\n")


if __name__ == "__main__":
    import sys
    
    if len(sys.argv) > 1 and sys.argv[1] == "--help":
        show_usage_instructions()
    else:
        test_agent_with_text_input()
