# CloudDocs - Документация по биллингу и оплате

## Тарифные планы

### Free Plan
**Бесплатно навсегда**
- 5 GB хранилища
- До 3 устройств
- Базовая синхронизация
- Email поддержка (48 часов)
- Шифрование данных
- История файлов 30 дней

### Premium Plan
**$9.99 / месяц**
- 100 GB хранилища
- Неограниченное количество устройств
- Приоритетная синхронизация
- Чат поддержка (12 часов)
- Расширенное шифрование
- История файлов 180 дней
- Расширенный доступ (права, группы)
- Офлайн режим

### Enterprise Plan
**от $29.99 / месяц**
- Неограниченное хранилище
- Все устройства
- Мгновенная синхронизация
- Выделенная поддержка (2 часа)
- SSO интеграция
- История файлов 365 дней
- Расширенный контроль доступа
- API доступ
- Кастомный брендинг
- SLA 99.9% uptime

---

## Методы оплаты

### Банковские карты
Принимаются:
- Visa
- MasterCard
- American Express
- Maestro (в некоторых регионах)

**Требования:**
- Карта должна поддерживать 3D Secure
- Для международных карт - разрешены онлайн платежи
- Достаточный баланс для оплаты

### PayPal
- Привязка PayPal аккаунта
- Автоматическое списание
- Поддержка всех валют PayPal

### Банковский перевод
Доступно для Enterprise планов:
- Минимальный платеж: $500
- Оплата за год вперед
- Скидка 20% при годовой оплате
- Выставление счета

### Криптовалюта
Доступно для Premium и Enterprise:
- Bitcoin (BTC)
- Ethereum (ETH)
- USDT
- Через CoinPayments

---

## Процесс оплаты

### Оформление подписки

1. **Выбор плана**
```
GET /api/billing/plans
Response:
{
  "plans": [
    {
      "id": "premium",
      "name": "Premium",
      "price": 9.99,
      "currency": "USD",
      "interval": "month"
    }
  ]
}
```

2. **Создание подписки**
```
POST /api/billing/subscriptions
{
  "plan_id": "premium",
  "payment_method": "card",
  "card_token": "tok_..."
}
```

3. **Подтверждение оплаты**
- 3D Secure верификация (если требуется)
- Получение confirmation webhook
- Активация подписки

### Автоматическое продление

Подписка автоматически продлевается:
- За 3 дня до окончания - отправка уведомления
- В день окончания - попытка списания
- При неудаче - повторные попытки 3 дня
- При неудаче всех попыток - понижение до Free

---

## Управление подпиской

### Повышение плана
```
POST /api/billing/subscriptions/upgrade
{
  "new_plan": "premium"
}
```

**Что происходит:**
- Немедленная активация нового плана
- Пропорциональный перерасчет (prorated)
- Списание разницы с текущего момента до конца периода

**Пример:**
- Текущий план: Free
- Новый план: Premium ($9.99/мес)
- Осталось дней: 15
- К оплате: $9.99 × (15/30) = ~$5.00

### Понижение плана
```
POST /api/billing/subscriptions/downgrade
{
  "new_plan": "free"
}
```

**Что происходит:**
- Изменение вступает в силу в конце текущего периода
- До конца периода сохраняется текущий план
- Возврат средств не производится
- Уведомление за 7 дней до изменения

### Отмена подписки
```
POST /api/billing/subscriptions/cancel
```

**Что происходит:**
- Подписка отменяется в конце текущего периода
- До конца периода сохраняется доступ
- Данные сохраняются 90 дней после отмены
- Можно возобновить подписку в любой момент

### Возобновление подписки
```
POST /api/billing/subscriptions/resume
```

---

## История платежей

### Просмотр истории
```
GET /api/billing/invoices
Response:
{
  "invoices": [
    {
      "id": "inv_123",
      "amount": 9.99,
      "currency": "USD",
      "status": "paid",
      "date": "2024-12-01",
      "pdf_url": "https://..."
    }
  ]
}
```

### Скачивание чеков
- PDF формат
- Содержит все детали оплаты
- Юридически значимый документ
- Доступны за весь период использования

---

## Возвраты

### Политика возврата

**14-дневная гарантия возврата денег:**
- Доступна для новых подписчиков
- Полный возврат средств
- Без объяснения причин
- Обработка 5-7 рабочих дней

**После 14 дней:**
- Возврат не предусмотрен
- Можно отменить подписку без дополнительных списаний
- Исключения возможны по решению поддержки

### Запрос возврата
```
POST /api/billing/refund
{
  "invoice_id": "inv_123",
  "reason": "не подошел функционал"
}
```

**Процесс:**
1. Запрос через API или поддержку
2. Проверка условий возврата
3. Одобрение/отклонение (1-2 дня)
4. Возврат средств (5-7 дней)

---

## Коды ошибок оплаты

### 4000 - Card Declined
**Причины:**
- Недостаточно средств
- Карта заблокирована
- Превышен лимит
- Карта просрочена

**Решение:**
- Проверьте баланс
- Свяжитесь с банком
- Попробуйте другую карту

### 4001 - Invalid Card
**Причины:**
- Неверный номер карты
- Неверный CVV
- Неверная дата окончания

**Решение:**
- Проверьте данные карты
- Убедитесь в правильности ввода

### 4002 - 3D Secure Failed
**Причины:**
- Отклонено банком
- Неверный код подтверждения
- Истекло время ожидания

**Решение:**
- Попробуйте снова
- Проверьте SMS от банка
- Используйте другую карту

### 4003 - Fraud Detection
**Причины:**
- Подозрительная активность
- Несовпадение данных
- Использование VPN/прокси

**Решение:**
- Отключите VPN
- Подтвердите личность через поддержку
- Используйте проверенный метод оплаты

---

## Налоги и НДС

### НДС (VAT)
Применяется для пользователей из ЕС:
- Стандартная ставка: зависит от страны (19-27%)
- Автоматический расчет по IP и billing address
- Отображается на странице оплаты
- Включается в итоговую сумму

### Налог с продаж (Sales Tax)
Для пользователей из США:
- Зависит от штата
- Автоматический расчет
- Некоторые штаты освобождены

### Business пользователи
Если у вас есть VAT ID:
```
POST /api/billing/vat
{
  "vat_id": "DE123456789"
}
```

При валидном VAT ID:
- НДС не начисляется
- Reverse charge mechanism
- VAT ID указывается в счете

---

## Промокоды и скидки

### Применение промокода
```
POST /api/billing/coupon
{
  "code": "PROMO2024"
}
```

**Типы скидок:**
- Процент от суммы (10%, 25%, 50%)
- Фиксированная сумма ($5, $10)
- Бесплатный период (1 месяц, 3 месяца)
- Первый платеж (только при первой оплате)

### Партнерские скидки
- Студенты: 50% на Premium
- Некоммерческие организации: 50%
- Образовательные учреждения: скидка по запросу
- Стартапы: программа скидок для ранних стадий

---

## Корпоративные счета

### Team Billing
Для команд от 5 человек:
- Единый счет на команду
- Централизованное управление
- Групповые скидки (от 10%)
- Один администратор биллинга

### Volume Discounts
Скидки по объему:
- 5-10 пользователей: 10%
- 11-25 пользователей: 15%
- 26-50 пользователей: 20%
- 51+ пользователей: индивидуально

### Оплата счетами
Для Enterprise (от $500/месяц):
- Ежемесячные или годовые счета
- Net 30 payment terms
- PO (Purchase Order) поддержка
- Dedicated account manager

---

## Troubleshooting

### Проблема: Оплата не проходит
**Шаги решения:**
1. Проверьте данные карты
2. Убедитесь в наличии средств
3. Попробуйте другую карту
4. Отключите VPN
5. Свяжитесь с банком
6. Используйте PayPal

### Проблема: Подписка не активировалась
**Причины:**
- Задержка обработки платежа
- Технический сбой
- Проблема с webhook

**Решение:**
- Подождите 10-15 минут
- Проверьте email с подтверждением
- Проверьте историю платежей
- Свяжитесь с поддержкой

### Проблема: Двойное списание
**Причины:**
- Технический сбой
- Повторная попытка оплаты
- Баг в системе

**Решение:**
- Проверьте историю платежей
- Одно из списаний будет возвращено автоматически (3-5 дней)
- Свяжитесь с поддержкой для ускорения

---

## API Reference

### Endpoints

```
GET    /api/billing/plans            # Список планов
GET    /api/billing/subscriptions    # Текущая подписка
POST   /api/billing/subscriptions    # Создать подписку
PUT    /api/billing/subscriptions    # Изменить подписку
DELETE /api/billing/subscriptions    # Отменить подписку
GET    /api/billing/invoices         # История платежей
GET    /api/billing/invoices/:id     # Детали платежа
POST   /api/billing/payment-methods  # Добавить метод оплаты
DELETE /api/billing/payment-methods/:id  # Удалить метод
POST   /api/billing/coupon           # Применить промокод
POST   /api/billing/refund           # Запросить возврат
```

### Webhooks

События биллинга:
```
subscription.created      # Создана подписка
subscription.updated      # Изменена подписка
subscription.cancelled    # Отменена подписка
payment.succeeded        # Успешная оплата
payment.failed           # Неудачная оплата
refund.created          # Создан возврат
invoice.created         # Создан счет
```

---

## Контакты поддержки

Вопросы по оплате:
- Email: billing@clouddocs.example.com
- Чат: на сайте (Premium/Enterprise)
- Время ответа:
  - Free: до 48 часов
  - Premium: до 12 часов
  - Enterprise: до 2 часов
